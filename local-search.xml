<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>web前端获取粘贴板图片</title>
    <link href="/2020/04/26/web%E7%AB%AF%E8%8E%B7%E5%8F%96%E7%B2%98%E8%B4%B4%E6%9D%BF%E5%9B%BE%E7%89%87/"/>
    <url>/2020/04/26/web%E7%AB%AF%E8%8E%B7%E5%8F%96%E7%B2%98%E8%B4%B4%E6%9D%BF%E5%9B%BE%E7%89%87/</url>
    
    <content type="html"><![CDATA[<h2 id="web前端js"><a href="#web前端js" class="headerlink" title="web前端js"></a>web前端js</h2><pre><code class="hljs plain">bindPaste();&#x2F;&#x2F;绑定粘贴事件var base64_str &#x3D; null;function bindPaste() &#123;&#x2F;&#x2F;定义变量存储获取的图片内容var blob;&#x2F;&#x2F;获取body对象var body &#x3D; document.getElementsByTagName(&quot;body&quot;);&#x2F;&#x2F;定义body标签绑定的粘贴事件处理函数var fun &#x3D; function(e) &#123;&#x2F;&#x2F;获取clipboardData对象var data &#x3D; e.clipboardData || window.clipboardData;&#x2F;&#x2F;获取图片内容blob &#x3D; data.items[0].getAsFile();&#x2F;&#x2F;判断是不是图片，最好通过文件类型判断var isImg &#x3D; (blob &amp;&amp; 1) || -1;var reader &#x3D; new FileReader();&#x2F;&#x2F;文件读取完成时触发reader.onload &#x3D; (function() &#123;return function(e) &#123;console.log(&quot;获得粘贴的结果&quot;, e.target.result);base64_str &#x3D; e.target.result;&#x2F;&#x2F;div中的img标签src属性赋值，可以直接展示图片$(&quot;#screenShoot&quot;).attr(&quot;src&quot;, base64_str);&#x2F;&#x2F;显示div$(&quot;#screenShoot&quot;).css(&quot;display&quot;, &quot;block&quot;);&#125;&#125;)();if (isImg &gt;&#x3D; 0) &#123;&#x2F;&#x2F;将文件读取为 DataURLreader.readAsDataURL(blob);&#125;&#125;&#x2F;&#x2F;通过body标签绑定粘贴事件，注意有些标签绑定粘贴事件可能出错body[0].removeEventListener(&#39;paste&#39;, fun);body[0].addEventListener(&#39;paste&#39;, fun);&#125;$(&quot;#sendBtn&quot;).on(&quot;click&quot;, function() &#123;$.ajax(&#123;type: &#39;get&#39;,url: conf.global_url + &quot;&#x2F;device&#x2F;saveToImgByStr&quot;,data: &#123;base64Str: base64_str,&#125;,cache: false,async: false,dataType: &#39;json&#39;,contentType: &#39;application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8&#39;,success: function(result) &#123;console.log(&quot;result&quot; + result);&#125;,error: function(XMLHttpRequest, textStatus, errorThrown) &#123;console.log(&#39;系统异常！&#39;);&#125;&#125;)&#125;)</code></pre><h2 id="后台获取base64数据转换图片并保存"><a href="#后台获取base64数据转换图片并保存" class="headerlink" title="后台获取base64数据转换图片并保存"></a>后台获取base64数据转换图片并保存</h2><pre><code class="hljs java"><span class="hljs-comment">//springboot 跨域注解</span>    <span class="hljs-meta">@CrossOrigin</span>(origins = <span class="hljs-string">"*"</span>)    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/saveToImgByStr"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveToImgByStr</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, String base64Str)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        String destDir = <span class="hljs-string">"/upload/image"</span>;        <span class="hljs-comment">//非springboot项目 可设置请求头解决跨域问题</span><span class="hljs-comment">//        response.setHeader("Access-Control-Allow-Origin", "*");</span>        base64Str = base64Str.replaceAll(<span class="hljs-string">"data:image/png;base64,"</span>, <span class="hljs-string">""</span>);        BASE64Decoder decoder = <span class="hljs-keyword">new</span> BASE64Decoder();        <span class="hljs-keyword">byte</span>[] imageByte = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            imageByte = decoder.decodeBuffer(base64Str);            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; imageByte.length; ++i) &#123;                <span class="hljs-keyword">if</span> (imageByte[i] &lt; <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">// 调整异常数据</span>                    imageByte[i] += <span class="hljs-number">256</span>;                &#125;            &#125;        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">if</span> (imageByte.length &gt; <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">//获取文件上传的真实路径</span><span class="hljs-comment">//                String uploadPath = request.getSession().getServletContext().getRealPath("/");</span>                <span class="hljs-comment">//保存文件的路径</span>                String filepath = destDir + File.separator + createNewDir();                File destfile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"D:"</span> + filepath);                <span class="hljs-keyword">if</span> (!destfile.exists()) &#123;                    destfile.mkdirs();                &#125;                <span class="hljs-comment">//文件新名称</span>                String fileNameNew = getFileNameNew() + <span class="hljs-string">".png"</span>;                File f = <span class="hljs-keyword">new</span> File(destfile.getAbsoluteFile() + File.separator + fileNameNew);                <span class="hljs-comment">// 将字符串转换成二进制，用于显示图片</span>                <span class="hljs-comment">// 将上面生成的图片格式字符串 imgStr，还原成图片显示</span>                InputStream in = <span class="hljs-keyword">new</span> ByteArrayInputStream(imageByte);                FileOutputStream fos = <span class="hljs-keyword">new</span> FileOutputStream(f);                <span class="hljs-comment">// BufferedOutputStream bos = new BufferedOutputStream(fos);</span>                <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];                <span class="hljs-keyword">int</span> length;                length = in.read(buf, <span class="hljs-number">0</span>, buf.length);                <span class="hljs-keyword">while</span> (length != -<span class="hljs-number">1</span>) &#123;                    fos.write(buf, <span class="hljs-number">0</span>, length);                    length = in.read(buf);                &#125;                fos.flush();                fos.close();                in.close();                String lastpath = filepath + File.separator + fileNameNew;                LOGGER.info(<span class="hljs-string">"返回图片路径："</span> + lastpath);;                <span class="hljs-keyword">return</span> lastpath;            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;                e.printStackTrace();            &#125; <span class="hljs-keyword">finally</span> &#123;            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;</code></pre>        ]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>日语测试</title>
    <link href="/2020/04/23/%E6%97%A5%E8%AF%AD%E6%B5%8B%E8%AF%95/"/>
    <url>/2020/04/23/%E6%97%A5%E8%AF%AD%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p>梦(ゆめ)ならばどれほどよかったでしょう</p><p>未(いま)だにあなたのことを梦(ゆめ)にみる</p><p>忘(わす)れた物(もの)を取(と)りに帰(かえ)るように</p><p>古(ふる)びた思(おも)い出(で)の埃(ほこり)を払(はら)う</p><p>戻(もど)らない幸(しあわ)せがあることを</p><p>最後(さいご)にあなたが教(おし)えてくれた</p><p>言(い)えずに隠(かく)してた昏(くら)い过去(かこ)も</p><p>あなたがいなきゃ永远(えいえん)に昏(くら)いまま</p><p>きっともうこれ以上(いじょう) 伤(きず)つくことなど</p><p>ありはしないとわかっている</p><p>あの日(ひ)の悲(かな)しみさえ</p><p>あの日(ひ)の苦(くる)しみさえ</p><p>そのすべてを爱(あい)してた あなたとともに</p><p>胸(むね)に残(のこ)り离(はな)れない</p><p>苦(にが)いレモン(れもん)の匂(にお)い</p><p>雨(あめ)が降(ふ)り止(や)むまでは帰(かえ)れない</p><p>今(いま)でもあなたはわたしの光(ひかり)</p><p>暗闇(くらやみ)であなたの背(せ)をなぞった</p><p>その轮廓(りんかく)を鲜明(せんめい)に覚(おぼ)えている</p><p>受(う)け止(と)めきれないものと出会(であ)うたび</p><p>溢(あふ)れてやまないのは涙(なみだ)だけ</p><p>何(なに)をしていたの</p><p>何(なに)を见(み)ていたの</p><p>わたしの知(し)らない横颜(よこがお)で</p><p>どこかであなたが今(いま)</p><p>わたしと同(おな)じ様(よう)な</p><p>涙(なみだ)にくれ 淋(さび)しさの中(なか)にいるなら</p><p>わたしのことなどどうか 忘(わす)れてください</p><p>そんなことを心(こころ)から愿(ねが)うほどに</p><p>今(いま)でもあなたはわたしの光(ひかり)</p><p>自分(じぶん)が思(おも)うより 恋(こい)をしていたあなたに</p><p>あれから思(おも)うように 息(いき)ができない</p><p>あんなに侧(そば)にいたのにまるで嘘(うそ)みたい</p><p>とても忘(わす)れられないそれだけが确(たし)か</p><p>あの日(ひ)の悲(かな)しみさえ<br>　　あの日(ひ)の苦(くる)しみさえ</p><p>その全(すべ)てを爱(あい)してたあなたと共(とも)に</p><p>胸(むね)に残(のこ)り离(はな)れない</p><p>苦(にが)いレモン(れもん)の匂(にお)い</p><p>雨(あめ)が降(ふ)り止(や)むまでは帰(かえ)れない</p><p>切(き)り分(わ)けた果実(かじつ)の片方(かたほう)の様(よう)に</p><p>今(いま)でもあなたはわたしの光(ひかり)。</p>]]></content>
    
    
    
    <tags>
      
      <tag>lemon歌词 日语</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>中文测试</title>
    <link href="/2020/04/23/%E4%B8%AD%E6%96%87%E6%B5%8B%E8%AF%95/"/>
    <url>/2020/04/23/%E4%B8%AD%E6%96%87%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p>中文测试 Chinese test 王老板51来玩啊 。</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
